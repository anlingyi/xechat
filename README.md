[xechat](https://chat.xeblog.cn:8088)
===

> åŸºäºSpringBoot+STOMPåè®®å®ç°çš„webèŠå¤©å®¤

* [ç›®å½•](#xechat)
   * [ç¯å¢ƒ](#ç¯å¢ƒ)
   * [éƒ¨ç½²](#éƒ¨ç½²)
      * [Linux & Windows](#linux--windows)
        * [åˆ›å»ºç›®å½•å¹¶æˆæƒ](#åˆ›å»ºç›®å½•å¹¶æˆæƒ)
        * [ä¿®æ”¹åº”ç”¨åœ°å€](#ä¿®æ”¹åº”ç”¨åœ°å€)
        * [ä¿®æ”¹ç™¾åº¦åœ°å›¾API](#ä¿®æ”¹ç™¾åº¦åœ°å›¾api)
        * [ç¼–è¯‘è¿è¡Œ](#ç¼–è¯‘è¿è¡Œ)
   * [åŠŸèƒ½](#åŠŸèƒ½)
      * [ç™»å…¥](#ç™»å…¥)
      * [å‘é€æ¶ˆæ¯](#å‘é€æ¶ˆæ¯)
      * [@å¥½å‹å¯è¿›è¡Œç§èŠ](#å¥½å‹å¯è¿›è¡Œç§èŠ)
      * [æ•æ„Ÿè¯æ£€æµ‹](#æ•æ„Ÿè¯æ£€æµ‹)
      * [æ³¨é”€](#æ³¨é”€)
      * [æ¶ˆæ¯æ’¤æ¶ˆ](#æ¶ˆæ¯æ’¤æ¶ˆ)
      * [èŠå¤©è®°å½•](#èŠå¤©è®°å½•)
         * [å¯†ç åŠ å¯†æ–¹å¼](#å¯†ç åŠ å¯†æ–¹å¼)
   * [v1.2æ›´æ–°](#v12æ›´æ–°)
      * [æ¥å…¥å›¾çµæœºå™¨äºº](#æ¥å…¥å›¾çµæœºå™¨äºº)
      * [é…ç½®æœºå™¨äºº](#é…ç½®æœºå™¨äºº)
      * [æ–°æ¶ˆæ¯é€šçŸ¥](#æ–°æ¶ˆæ¯é€šçŸ¥)

## ç¯å¢ƒ

* JDK1.8
* Maven
* IDEA
* Lombok Plugin

## éƒ¨ç½²

### Linux & Windows

> éƒ¨ç½²å‰éœ€å…ˆå®‰è£…é…ç½®å¥½ `JDK8` ã€`Maven3` ç­‰ç¯å¢ƒã€‚

#### åˆ›å»ºç›®å½•å¹¶æˆæƒ

`Linux` ç³»ç»Ÿä¸€èˆ¬éœ€æ‰§è¡Œæ­¤æ­¥éª¤ã€‚    
`Windows` ç³»ç»Ÿé»˜è®¤åˆ›å»ºçš„ç›®å½•åœ¨é¡¹ç›®æ‰€å¤„çš„ç›˜ç¬¦æ ¹ç›®å½•ä¸­ï¼Œéœ€ä¿®æ”¹ `application.properties` é‡Œçš„ç›®å½•æ˜ å°„é…ç½® 
`file.directoryMappingï¼æ‰€åœ¨ç›˜ç¬¦:\\xechat\\`

```
# å­˜æ”¾æ—¥å¿—çš„ç›®å½•
sudo mkdir /var/log/xechat
# èµ„æºæ˜ å°„çš„ç›®å½•
sudo mkdir /xechat
# æˆæƒ
sudo chmod 777 /var/log/xechat
sudo chmod 777 /xechat
```

#### ä¿®æ”¹åº”ç”¨åœ°å€

> æ­¤é…ç½®ä¼šå½±å“åˆ°èŠå¤©å›¾ç‰‡å’ŒèŠå¤©è®°å½•ç­‰æ–‡ä»¶çš„è®¿é—®ï¼Œæœ¬åœ°éƒ¨ç½²é»˜è®¤å³å¯ï¼Œçº¿ä¸ŠæœåŠ¡å™¨éƒ¨ç½²è¯·ä¿®æ”¹ä¸ºæœåŠ¡å™¨å…¬ç½‘IPæˆ–è®¿é—®åŸŸåã€‚

`application.properties` é…ç½®æ–‡ä»¶é‡Œå°† `app.url` çš„å€¼ä¿®æ”¹å³å¯

```
#é¡¹ç›®åœ°å€
app.url=http://localhost:${server.port}
```

#### ä¿®æ”¹ç™¾åº¦åœ°å›¾API

> ä¸æ”¹ä¹Ÿè¡Œã€‚ã€‚ã€‚

é¡¹ç›®ä¸­çš„å®šä½åŠŸèƒ½ä½¿ç”¨çš„æ˜¯ç™¾åº¦åœ°å›¾çš„API

éœ€å°† `ak` çš„å€¼æ›¿æ¢æˆè‡ªå·±çš„

![](https://i.loli.net/2019/04/06/5ca84c07051d7.png)

#### ç¼–è¯‘è¿è¡Œ

finalName: `maven`æ‰“åŒ…çš„æ–‡ä»¶åï¼Œåœ¨`pom.xml`æ–‡ä»¶ä¸­ç”±`<build>`æ ‡ç­¾å†…çš„`<finalName>`æŒ‡å®š

env: é¡¹ç›®è¿è¡Œç¯å¢ƒï¼Œæµ‹è¯•ç¯å¢ƒ`test` ç”Ÿäº§ç¯å¢ƒ`prod`

```
mvn clean install -Dmaven.test.skip=true
java -jar ${finalName}.jar --spring.profiles.active=${env}
```

## åŠŸèƒ½

> https://xeblog.cn/articles/13

### ç™»å…¥

> ç™»å…¥æˆåŠŸåä¼šå°†ç”¨æˆ·ä¿¡æ¯ç¼“å­˜åˆ°cookieä¸­

ç™»å…¥ç•Œé¢

![](https://i.loli.net/2019/04/06/5ca79db0e46ca.png
)

é€‰æ‹©å¤´åƒè¾“å…¥æ˜µç§°åç‚¹å‡»ç™»å…¥æŒ‰é’®

![](https://i.loli.net/2019/04/06/5ca7ad4eca558.png)

![](https://i.loli.net/2019/04/06/5ca79db12d5f8.png)

ç³»ç»Ÿå¹¿æ’­ä¸Šçº¿æ¶ˆæ¯

![](https://i.loli.net/2019/04/06/5ca79db1198e2.png)

### å‘é€æ¶ˆæ¯

å‘é€æ–‡æœ¬æ¶ˆæ¯

![](https://i.loli.net/2019/04/06/5ca79db12e464.png)

å‘é€å›¾ç‰‡æ¶ˆæ¯

![](https://i.loli.net/2019/04/06/5ca79db14f6cf.png)

å†æ¬¡ç™»å…¥ä¸¤ä¸ªç”¨æˆ·

![](https://i.loli.net/2019/04/06/5ca79db12d397.png)

![](https://i.loli.net/2019/04/06/5ca79db12e764.png)

å·¦ä¾§æŒ‰é’®ä¸ºæ˜¾ç¤ºåœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼Œå³ä¾§æŒ‰é’®ä¸ºé€€å‡ºèŠå¤©å®¤

![](https://i.loli.net/2019/04/06/5ca79db147f7b.png)

### @å¥½å‹å¯è¿›è¡Œç§èŠ

![](https://i.loli.net/2019/04/06/5ca7a0cd0a49b.png)

![](https://i.loli.net/2019/04/06/5ca7a0cd0b406.png)

![](https://i.loli.net/2019/04/06/5ca7a0cd0bb47.png)

å°æ¯…è¿™ä¸ªç”¨æˆ·æ”¶ä¸åˆ°èƒ–è™å’Œå°ä¸¸å­çš„ç§èŠä¿¡æ¯

![](https://i.loli.net/2019/04/06/5ca7a0cd09e53.png)

### æ•æ„Ÿè¯æ£€æµ‹

> ä½¿ç”¨DFAç®—æ³•æ£€æµ‹æ–‡æœ¬æ˜¯å¦åŒ…å«æ•æ„Ÿè¯ï¼ˆDFAï¼šDeterministic Finite Automaton ç¡®å®šæ€§æœ‰é™è‡ªåŠ¨æœºï¼‰

æ•æ„Ÿè¯åˆ—è¡¨

> æ•æ„Ÿè¯çš„é…ç½®æ˜¯åœ¨ `resources` ç›®å½•ä¸‹çš„ `sensitive-word.txt` æ–‡ä»¶ä¸­ï¼Œæ•æ„Ÿè¯ä¸€è¡Œä¸€ä¸ª

![](https://i.loli.net/2019/04/06/5ca7a0ccb2ef1.png)

å‘é€ä¸€ä¸ªåŒ…å«æ•æ„Ÿè¯çš„æ–‡æœ¬ä¿¡æ¯ï¼ˆæ­¤å¤„è¾“å…¥çš„æ•æ„Ÿè¯ä¸ºå˜»å˜»å’Œå“ˆå“ˆï¼‰

![](https://i.loli.net/2019/04/06/5ca7a0cd05b1a.png)

æˆåŠŸè¢«ç³»ç»Ÿæ²³èŸ¹ğŸ˜ æ²³èŸ¹åçš„å¤„ç†æ˜¯éšæœºè¿”å›ä¸€ä¸ªç¤¾ä¼šä¸»ä¹‰æ ¸å¿ƒä»·å€¼è§‚ã€‚

> å¯Œå¼ºã€æ°‘ä¸»ã€æ–‡æ˜ã€å’Œè°ã€è‡ªç”±ã€å¹³ç­‰ã€å…¬æ­£ã€æ³•æ²»ã€çˆ±å›½ã€æ•¬ä¸šã€è¯šä¿¡ã€å‹å–„

![](https://i.loli.net/2019/04/06/5ca7a0cd0aae3.png)


è¿‡æ»¤æ—¥å¿—

![](https://i.loli.net/2019/04/06/5ca7a0cd12e86.png)

### æ³¨é”€

ç‚¹å‡»å³ä¾§æŒ‰é’®é€€å‡ºèŠå¤©å®¤ï¼Œç³»ç»Ÿå¹¿æ’­ç¦»çº¿æ¶ˆæ¯ï¼Œåœ¨çº¿ç”¨æˆ·åˆ—è¡¨å’Œåœ¨çº¿äººæ•°è‡ªåŠ¨æ›´æ–°

![](https://i.loli.net/2019/04/06/5ca7a76746726.png)

ç‚¹å‡»æ³¨é”€æŒ‰é’®å¯æ¸…é™¤å½“å‰çš„ç™»å…¥ä¿¡æ¯ï¼Œä¸æ³¨é”€åˆ™å¯ç»§ç»­ä»¥å½“å‰çš„ä¿¡æ¯ç™»å…¥

![](https://i.loli.net/2019/04/06/5ca7a0ccf1886.png)

ä¸æ³¨é”€ç›´æ¥ç™»å…¥

![](https://i.loli.net/2019/04/06/5ca7a7673d067.png)

### æ¶ˆæ¯æ’¤æ¶ˆ

åŒå‡»è‡ªå·±å‘é€çš„æ¶ˆæ¯å¼¹å‡ºæ’¤æ¶ˆæç¤ºï¼Œç¡®å®šåå³å¯æ’¤æ¶ˆè¿™æ¡æ¶ˆæ¯ï¼ˆåªå¯æ’¤æ¶ˆ3åˆ†é’Ÿå†…çš„æ¶ˆæ¯ï¼‰

![](https://i.loli.net/2019/04/06/5ca7a7674299c.png)

æ¶ˆæ¯å·²ç»æ’¤æ¶ˆï¼Œç³»ç»Ÿå¹¿æ’­æ’¤æ¶ˆæ¶ˆæ¯

![](https://i.loli.net/2019/04/06/5ca7a767405c8.png)

![](https://i.loli.net/2019/04/06/5ca7a767447ad.png)

### èŠå¤©è®°å½•

èŠå¤©è®°å½•è®¿é—®åœ°å€ `http://ip:ç«¯å£/record.html`

è¿›å…¥èŠå¤©è®°å½•é¡µé¢éœ€è¦è¾“å…¥è®¿é—®å¯†ç  é»˜è®¤çš„è®¿é—®å¯†ç ä¸º `xechat`

#### å¯†ç åŠ å¯†æ–¹å¼

> å…ˆå°†å¯†ç ç»è¿‡ `BASE64` åŠ å¯†åå†è¿›è¡Œ `MD5` çš„32ä½å°å†™åŠ å¯†

**åŠ å¯†æµç¨‹**

 å¯†ç  `xechat` ç»è¿‡ `BASE64` åŠ å¯†åå˜ä¸º `eGVjaGF0` ï¼Œå†è¿›è¡Œ `MD5` 32ä½å°å†™åŠ å¯†åå˜ä¸º `c85715fec7827f3b388af185b8e7db77`

**ä¿®æ”¹å¯†ç **

`application.properties` é…ç½®æ–‡ä»¶é‡Œå°† `chatrecord.password` çš„å€¼æ›¿æ¢å³å¯

```
#èŠå¤©è®°å½•é¡µé¢è®¿é—®å¯†ç (å¯†ç å…ˆç»è¿‡base64åŠ å¯†åå†è¿›è¡Œ32ä½md5åŠ å¯†)
chatrecord.password=c85715fec7827f3b388af185b8e7db77
```

è¾“å…¥å¯†ç ç‚¹å‡»ç¡®å®š

![](https://i.loli.net/2019/04/06/5ca83f71dbaba.png)

å¯†ç è¾“å…¥æ­£ç¡®åæ˜¾ç¤ºèŠå¤©è®°å½•æ–‡ä»¶åˆ—è¡¨ï¼ŒæŒ‰ç…§ `yyyyMMdd` çš„æ–¹å¼æ¯å¤©è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª `.md` æ ¼å¼çš„æ–‡ä»¶

![](https://i.loli.net/2019/04/06/5ca83f71eeacf.png)

ç‚¹å‡»åˆ—è¡¨ä¸­çš„æ–‡ä»¶å¯ä»¥æŸ¥çœ‹å½“å¤©çš„èŠå¤©è®°å½•

![](https://i.loli.net/2019/04/06/5ca83f724e593.png)

![](https://i.loli.net/2019/04/06/5ca83f7252659.png)

## v1.2æ›´æ–°

### æ¥å…¥å›¾çµæœºå™¨äºº

> [https://xeblog.cn/articles/14](https://xeblog.cn/articles/14)

> å›¾çµæœºå™¨äººå®˜ç½‘ [http://www.turingapi.com](http://www.turingapi.com)  
> APIæ–‡æ¡£ [https://www.kancloud.cn/turing/www-tuling123-com/718227](https://www.kancloud.cn/turing/www-tuling123-com/718227)

![xechat_v1.2.png](https://i.loli.net/2019/05/09/5cd3ed540d264.png)

### é…ç½®æœºå™¨äºº

**ä¿®æ”¹å›¾çµApiKey**

![turing_apikey.png](https://i.loli.net/2019/05/09/5cd3fa34df040.png)

`application.properties` é…ç½®æ–‡ä»¶é‡Œä¿®æ”¹ `turing.apiKey` çš„å€¼

```
#å›¾çµapikey
turing.apiKey=xxx
```

**ä¿®æ”¹æœºå™¨äººä¿¡æ¯**

ä¿®æ”¹ `cn.xeblog.xechat.constant.RobotConstant` ç±»ä¸­å¯¹åº”å¸¸é‡

```
package cn.xeblog.xechat.constant;

/**
 * æœºå™¨äººç›¸å…³å¸¸é‡
 *
 * @author yanpanyi
 * @date 2019/4/10
 */
public interface RobotConstant {
    /**
     * å­˜å‚¨çš„key
     */
    String key = "robot";
    /**
     * è§¦å‘æœºå™¨äººèŠå¤©çš„æ¶ˆæ¯å‰ç¼€
     */
    String prefix = "#";
    /**
     * æœºå™¨äººåç§°
     */
    String name = "å°å°æ¯…";
    /**
     * æœºå™¨äººå¤´åƒ
     */
    String avatar = "./images/avatar/robot.jpeg";
    /**
     * æœºå™¨äººåœ°ç†ä½ç½®
     */
    String address = "ç«æ˜Ÿ";
}
```

**ä¿®æ”¹æœºå™¨äººæ¬¢è¿ä¿¡æ¯**

ä¿®æ”¹ `cn.xeblog.xechat.constant.MessageConstant` ç±»ä¸­å¯¹åº”å¸¸é‡

```
package cn.xeblog.xechat.constant;

/**
 * æ¶ˆæ¯æ¨¡æ¿
 *
 * @author anlingyi
 * @date 2019/5/7
 */
public interface MessageConstant {
    /**
     * è¿›å…¥èŠå¤©å®¤å¹¿æ’­æ¶ˆæ¯
     */
    String ONLINE_MESSAGE = "%sè¿›å…¥äº†èŠå¤©å®¤";
    /**
     * ç¦»å¼€èŠå¤©å®¤å¹¿æ’­æ¶ˆæ¯
     */
    String OFFLINE_MESSAGE = "%sç¦»å¼€äº†èŠå¤©å®¤";
    /**
     * æœºå™¨äººæ¬¢è¿æ¶ˆæ¯
     */
    String ROBOT_WELCOME_MESSAGE = "@%s æ¬¢è¿æ¥åˆ°èŠå¤©å®¤ï¼æ¶ˆæ¯å†…å®¹ä»¥'#'å¼€å¤´çš„æˆ‘å°±èƒ½æ”¶åˆ°å“¦ï¼ˆPSï¼šåŒå‡»æˆ‘çš„å¤´åƒä¸æˆ‘èŠå¤©ï¼‰ï¼Œ" +
            "éšæ—¶æ¥æ’©æˆ‘å‘€ï¼";
}

```

**å®é™…æ•ˆæœ**

![xechat_v1.2_1.png](https://i.loli.net/2019/05/09/5cd4175b9b284.png)

![xechat_v1.2_2.png](https://i.loli.net/2019/05/09/5cd4175b98e71.png)

![xechat_v1.2_3.png](https://i.loli.net/2019/05/09/5cd4175b9fb63.png)

![xechat_v1.2_4.png](https://i.loli.net/2019/05/09/5cd4175bb280f.png)

![xechat_v1.2_5.png](https://i.loli.net/2019/05/09/5cd4175bacd75.png)

![é“ä»”è¯­å¡.gif](https://i.loli.net/2019/05/09/5cd4196fd7e4c.gif)

### æ–°æ¶ˆæ¯é€šçŸ¥

> [https://xeblog.cn/articles/22](https://xeblog.cn/articles/22)

é€šè¿‡å‹¾é€‰æ–°æ¶ˆæ¯é€šçŸ¥ã€æ¶ˆæ¯æç¤ºéŸ³ç­‰è®¾ç½®é¡¹å¼€å¯ç›¸åº”åŠŸèƒ½ã€‚

![xechat_v1.2_6.png](https://oss.xeblog.cn/prod/89d1f5d2fa8d41e7b6e8d54014de9919.png)

é€šçŸ¥æ•ˆæœ

![xechat_v1.2_7.png](https://oss.xeblog.cn/prod/e8fc9629eaff4751aeb7b0e5330ffda5.png)